import{a as bn}from"./chunk-VL2XSCZ4.js";import{a as Fn}from"./chunk-TKKYYT54.js";import{a as gn,b as _n}from"./chunk-UD2WINGS.js";import{a as Se,b as Pe}from"./chunk-Y4CW2EKJ.js";import{a as Cn,b as xn,c as Mn,d as vn,e as yn,f as wn,g as Sn,h as Pn,i as On,j as Dn,k as An}from"./chunk-UPL2R5GG.js";import{a as we,b as hn}from"./chunk-BBXVUU3K.js";import{a as Ht,b as Ut}from"./chunk-PLROVZFR.js";import{b as Zt,c as Gt,d as Xt,e as Kt,g as Yt}from"./chunk-OXZSZJOM.js";import{a as fn}from"./chunk-HVLXCAJY.js";import{a as I,b as Wt,d as Jt}from"./chunk-PLTHVZGS.js";import{a as mn}from"./chunk-NTYXZ34B.js";import{d as sn,e as ln}from"./chunk-QJXU5I4V.js";import"./chunk-2JZIK3TK.js";import{b as cn,e as dn,f as pn}from"./chunk-T4WFKTQX.js";import{a as tn,b as nn,c as be}from"./chunk-DFYIO73B.js";import"./chunk-HS6AUOCB.js";import{e as en}from"./chunk-B7JMTDAV.js";import"./chunk-TJC2M7GG.js";import"./chunk-2IAXMR6M.js";import{a as on}from"./chunk-SQZYZJQ3.js";import{a as _e}from"./chunk-A3N3AUUJ.js";import"./chunk-JS3QJ7O4.js";import{A as qt,B as Qt,d as T,j as le,l as Dt,n as ge,p as jt,s as B,t as Nt,u as R}from"./chunk-HSPBE7XI.js";import{b as wt,c as St,i as Pt,j as Ot}from"./chunk-EVUXJHDY.js";import{g as q,h as Ct,i as re,j as xt,p as se}from"./chunk-KXTQ2UTD.js";import{c as Mt,d as ke,e as Te,g as Be,h as Re,j as Ie,k as Le,l as Ve}from"./chunk-I7VYXJU2.js";import{a as un}from"./chunk-QOLJLHMH.js";import{a as de,c as pe,e as $t,f as ue,g as fe,i as zt,l as he}from"./chunk-TPOWQI3K.js";import{a as Ce,b as xe,c as an,d as rn,e as Me,f as ve,i as ye}from"./chunk-A6OBOLX6.js";import{a as w,c as Ft,e as Et,h as kt,i as Tt,j as me,l as A,m as Bt,p as Rt,r as It,s as Lt,w as ce,x as Vt}from"./chunk-5R3537JV.js";import{D as yt,E as z,W as $e,X as ze,Y as He,a as Ee,s as vt,wa as At}from"./chunk-U457VICD.js";import{$b as S,Ac as oe,D as We,Ea as ot,F as L,Fb as V,Fc as ft,Gc as ae,Ha as W,I as Je,Ia as at,Ja as rt,Jc as O,Kb as te,Kc as D,L as y,Nb as g,Sb as ct,Sc as ht,Tb as u,Xc as gt,Yb as M,Zc as _t,a as J,ac as P,b as Xe,ba as et,bc as s,cc as r,d as U,dc as p,ea as tt,ec as ne,fa as nt,fc as ie,gb as st,ha as Fe,hc as v,j as Ke,jc as dt,je as N,ka as d,kc as f,lb as l,lc as pt,mc as h,o as Ye,pe as bt,t as Y,ta as _,u as j,ua as b,ub as C,vb as lt,wb as ee,wc as ut,xa as it,xb as mt,xc as c,yc as k,zc as $}from"./chunk-TEKHUYWQ.js";var En=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["devmx-album-feature-admin"]],decls:1,vars:0,template:function(n,i){n&1&&p(0,"router-outlet")},dependencies:[Ct],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column}"],changeDetection:0})}return t})();function ei(t,a){}var ti={bottomSheetState:Mt("state",[Re("void, hidden",Be({transform:"translateY(100%)"})),Re("visible",Be({transform:"translateY(0%)"})),Ie("visible => void, visible => hidden",Te([ke(`${ze.COMPLEX} ${$e.ACCELERATION_CURVE}`),Ve("@*",Le(),{optional:!0})])),Ie("void => visible",Te([ke(`${ze.EXITING} ${$e.DECELERATION_CURVE}`),Ve("@*",Le(),{optional:!0})]))])},ni=(()=>{class t extends cn{_breakpointSubscription;_animationState="void";_animationStateChanged=new ot;_destroyed;constructor(){super();let e=d(yt);this._breakpointSubscription=e.observe([z.Medium,z.Large,z.XLarge]).subscribe(()=>{let n=this._elementRef.nativeElement.classList;n.toggle("mat-bottom-sheet-container-medium",e.isMatched(z.Medium)),n.toggle("mat-bottom-sheet-container-large",e.isMatched(z.Large)),n.toggle("mat-bottom-sheet-container-xlarge",e.isMatched(z.XLarge))})}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges())}exit(){this._destroyed||(this._animationState="hidden",this._changeDetectorRef.markForCheck())}ngOnDestroy(){super.ngOnDestroy(),this._breakpointSubscription.unsubscribe(),this._destroyed=!0}_onAnimationDone(e){e.toState==="visible"&&this._trapFocus(),this._animationStateChanged.emit(e)}_onAnimationStart(e){this._animationStateChanged.emit(e)}_captureInitialFocus(){}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["mat-bottom-sheet-container"]],hostAttrs:["tabindex","-1",1,"mat-bottom-sheet-container"],hostVars:4,hostBindings:function(n,i){n&1&&pt("@state.start",function(m){return i._onAnimationStart(m)})("@state.done",function(m){return i._onAnimationDone(m)}),n&2&&(dt("@state",i._animationState),ct("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-label",i._config.ariaLabel))},features:[te],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(n,i){n&1&&g(0,ei,0,0,"ng-template",0)},dependencies:[qt],styles:[".mat-bottom-sheet-container{box-shadow:0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12);padding:8px 16px;min-width:100vw;box-sizing:border-box;display:block;outline:0;max-height:80vh;overflow:auto;background:var(--mat-bottom-sheet-container-background-color, var(--mat-sys-surface-container-low));color:var(--mat-bottom-sheet-container-text-color, var(--mat-sys-on-surface));font-family:var(--mat-bottom-sheet-container-text-font, var(--mat-sys-body-large-font));font-size:var(--mat-bottom-sheet-container-text-size, var(--mat-sys-body-large-size));line-height:var(--mat-bottom-sheet-container-text-line-height, var(--mat-sys-body-large-line-height));font-weight:var(--mat-bottom-sheet-container-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mat-bottom-sheet-container-text-tracking, var(--mat-sys-body-large-tracking))}@media(forced-colors: active){.mat-bottom-sheet-container{outline:1px solid}}.mat-bottom-sheet-container-xlarge,.mat-bottom-sheet-container-large,.mat-bottom-sheet-container-medium{border-top-left-radius:var(--mat-bottom-sheet-container-shape, 28px);border-top-right-radius:var(--mat-bottom-sheet-container-shape, 28px)}.mat-bottom-sheet-container-medium{min-width:384px;max-width:calc(100vw - 128px)}.mat-bottom-sheet-container-large{min-width:512px;max-width:calc(100vw - 256px)}.mat-bottom-sheet-container-xlarge{min-width:576px;max-width:calc(100vw - 384px)}"],encapsulation:2,data:{animation:[ti.bottomSheetState]}})}return t})(),je=new Fe("MatBottomSheetData"),Ue=class{viewContainerRef;panelClass;direction;data=null;hasBackdrop=!0;backdropClass;disableClose=!1;ariaLabel=null;ariaModal=!0;closeOnNavigation=!0;autoFocus="dialog";restoreFocus=!0;scrollStrategy;height="";minHeight;maxHeight},Q=class{_ref;get instance(){return this._ref.componentInstance}get componentRef(){return this._ref.componentRef}containerInstance;disableClose;_afterOpened=new Ke;_result;_closeFallbackTimeout;constructor(a,e,n){this._ref=a,this.containerInstance=n,this.disableClose=e.disableClose,n._animationStateChanged.pipe(L(i=>i.phaseName==="done"&&i.toState==="visible"),y(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),n._animationStateChanged.pipe(L(i=>i.phaseName==="done"&&i.toState==="hidden"),y(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._ref.close(this._result)}),a.overlayRef.detachments().subscribe(()=>{this._ref.close(this._result)}),We(this.backdropClick(),this.keydownEvents().pipe(L(i=>i.keyCode===27))).subscribe(i=>{!this.disableClose&&(i.type!=="keydown"||!vt(i))&&(i.preventDefault(),this.dismiss())})}dismiss(a){this.containerInstance&&(this.containerInstance._animationStateChanged.pipe(L(e=>e.phaseName==="start"),y(1)).subscribe(e=>{this._closeFallbackTimeout=setTimeout(()=>{this._ref.close(this._result)},e.totalTime+100),this._ref.overlayRef.detachBackdrop()}),this._result=a,this.containerInstance.exit(),this.containerInstance=null)}afterDismissed(){return this._ref.closed}afterOpened(){return this._afterOpened}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}},ii=new Fe("mat-bottom-sheet-default-options"),Ne=(()=>{class t{_overlay=d(en);_parentBottomSheet=d(t,{optional:!0,skipSelf:!0});_defaultOptions=d(ii,{optional:!0});_bottomSheetRefAtThisLevel=null;_dialog=d(dn);get _openedBottomSheetRef(){let e=this._parentBottomSheet;return e?e._openedBottomSheetRef:this._bottomSheetRefAtThisLevel}set _openedBottomSheetRef(e){this._parentBottomSheet?this._parentBottomSheet._openedBottomSheetRef=e:this._bottomSheetRefAtThisLevel=e}constructor(){}open(e,n){let i=J(J({},this._defaultOptions||new Ue),n),o;return this._dialog.open(e,Xe(J({},i),{disableClose:!0,closeOnOverlayDetachments:!1,maxWidth:"100%",container:ni,scrollStrategy:i.scrollStrategy||this._overlay.scrollStrategies.block(),positionStrategy:this._overlay.position().global().centerHorizontally().bottom("0"),templateContext:()=>({bottomSheetRef:o}),providers:(m,x,H)=>(o=new Q(m,i,H),[{provide:Q,useValue:o},{provide:je,useValue:i.data}])})),o.afterDismissed().subscribe(()=>{this._openedBottomSheetRef===o&&(this._openedBottomSheetRef=null)}),this._openedBottomSheetRef?(this._openedBottomSheetRef.afterDismissed().subscribe(()=>o.containerInstance?.enter()),this._openedBottomSheetRef.dismiss()):o.containerInstance.enter(),this._openedBottomSheetRef=o,o}dismiss(e){this._openedBottomSheetRef&&this._openedBottomSheetRef.dismiss(e)}ngOnDestroy(){this._bottomSheetRefAtThisLevel&&this._bottomSheetRefAtThisLevel.dismiss()}static \u0275fac=function(n){return new(n||t)};static \u0275prov=tt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),kn=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=lt({type:t});static \u0275inj=nt({providers:[Ne],imports:[pn,He,Qt,He]})}return t})();var Tn=(()=>{class t{ref=d(Q);data=d(je);close(e){this.ref.dismiss(e)}static \u0275fac=function(n){return new(n||t)};static \u0275dir=ee({type:t})}return t})();var Z=class{sheet;constructor(a){this.sheet=a}open(a,e){return this.sheet.open(a,{data:e,autoFocus:!0,restoreFocus:!0,panelClass:"devmx-sheet"}).afterDismissed()}};function Bn(){return{provide:Z,deps:[Ne]}}var Rn=[Pe(),hn(),Bn()];var In=t=>Jt(d(I),t.params);function ai(t,a){t&1&&(s(0,"th",15),c(1,"T\xEDtulo do album"),r())}function ri(t,a){if(t&1&&(s(0,"td",16),c(1),r()),t&2){let e=a.$implicit;l(),k(e.title)}}function si(t,a){t&1&&(s(0,"th",15),c(1,"Criado por"),r())}function li(t,a){if(t&1&&(s(0,"td",16),c(1),r()),t&2){let e=a.$implicit;l(),k(e.owner.displayName)}}function mi(t,a){t&1&&p(0,"th",15)}function ci(t,a){if(t&1){let e=v();s(0,"td",16)(1,"button",17),f("click",function(){let i=_(e).$implicit,o=h(2);return b(o.openDelete(i))}),p(2,"devmx-icon",18),r()()}}function di(t,a){t&1&&p(0,"tr",19)}function pi(t,a){t&1&&p(0,"tr",20)}function ui(t,a){if(t&1){let e=v();s(0,"table",5),ne(1,6),g(2,ai,2,0,"th",7)(3,ri,2,1,"td",8),ie(),ne(4,9),g(5,si,2,0,"th",7)(6,li,2,1,"td",8),ie(),ne(7,10),g(8,mi,1,0,"th",7)(9,ci,3,0,"td",8),ie(),g(10,di,1,0,"tr",11)(11,pi,1,0,"tr",12),r(),s(12,"mat-card-actions",13)(13,"devmx-paginator",14),f("pageChange",function(i){_(e);let o=h();return b(o.onPageChange(i))}),r()()}if(t&2){let e=a,n=h();u("dataSource",e.data),l(10),u("matHeaderRowDef",n.columns),l(),u("matRowDefColumns",n.columns),l(2),u("size",10)("items",e.items)}}var Ln=(()=>{class t{router=d(re);route=d(q);dialogFacade=d(we);albumFacade=d(I);selectUser=d(Se);#e=Dt(null);columns=["title","owner","actions"];constructor(){let e=this.#e.observe().pipe(Y(i=>i?i.id:"")),n=this.route.queryParams;j([e,n]).pipe(_e()).subscribe(this.onQueryParams)}onQueryParams=([e,n])=>{let{page:i=0,size:o=10}=n,m={title:"",owner:e};this.albumFacade.setParams({page:i,size:o,filter:m}),this.albumFacade.load()};openDelete({id:e,title:n}){this.dialogFacade.confirm(`Confirme que deseja apagar o album ${n}`,"Esta a\xE7\xE3o n\xE3o poder\xE1 ser desfeita").subscribe(i=>{i&&this.albumFacade.delete(e)})}openSelectUser(){this.selectUser.open({multiple:!1}).subscribe(e=>{e&&this.#e.update(e)})}onSearchChange(e=""){this.albumFacade.setFilter({title:e}),this.albumFacade.load()}onPageChange({page:e,size:n}){let i={page:e,size:n};this.router.navigate([],{queryParams:i})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["devmx-album-admin-manage-albums"]],decls:10,vars:4,consts:[[1,"albums-card"],[1,"albums-card-header"],["mat-icon-button","",3,"click"],["name","filter"],[3,"searchChange","debounce"],["mat-table","",3,"dataSource"],["matColumnDef","title"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","owner"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["align","end"],[3,"pageChange","size","items"],["mat-header-cell",""],["mat-cell",""],["type","button","mat-icon-button","",3,"click"],["name","trash"],["mat-header-row",""],["mat-row",""]],template:function(n,i){if(n&1&&(s(0,"mat-card",0)(1,"mat-card-header",1)(2,"mat-card-title"),c(3,"Albuns"),r(),s(4,"div")(5,"button",2),f("click",function(){return i.openSelectUser()}),p(6,"devmx-icon",3),r(),s(7,"devmx-search-field",4),f("searchChange",function(m){return i.onSearchChange(m)}),r()()(),g(8,ui,14,5),O(9,"async"),r()),n&2){let o;l(7),u("debounce",1e3),l(),M((o=D(9,2,i.albumFacade.response$))?8:-1,o)}},dependencies:[se,R,B,mn,be,An,Cn,Mn,Sn,vn,xn,Pn,yn,wn,On,Dn,ye,Ce,Me,ve,xe,w,N],styles:["[_nghost-%COMP%]{flex:1;padding:1em;display:flex;flex-direction:column}[_nghost-%COMP%]   .albums-card[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .albums-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;border-bottom:1px dashed rgba(0,0,0,.1)}[_nghost-%COMP%]   .albums-card-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{gap:2em;display:flex;align-items:baseline}[_nghost-%COMP%]   .mat-mdc-table[_ngcontent-%COMP%]   .mat-column-actions[_ngcontent-%COMP%]{max-width:3em}"],changeDetection:0})}return t})();function Vn(t){return T((a,e)=>{let n=new FileReader;n.onload=()=>{n.result instanceof ArrayBuffer&&a(n.result)},n.onerror=()=>{e(new Error("Falha ao ler ArrayBuffer"))},n.readAsArrayBuffer(t)})}function $n(t){return"0x"+parseInt(`${t}`).toString(16)}function zn(t){return T(a=>U(this,null,function*(){let e=t.slice(0,4),n=yield Vn(e),o=new DataView(n).getUint32(0,!1);switch(console.log($n(o)),o){case 2303741511:return a("image/png");case 1195984440:return a("image/gif");case 1380533830:return a("image/webp");case 1014199911:return a("image/svg+xml");case 4292411360:case 4292411361:case 4292411374:return a("image/jpeg");default:return a(null)}}))}var Oe=(()=>{class t{elRef=d(rt);get el(){return this.elRef.nativeElement}accept=at([]);enter=W();over=W();leave=W();files=W();onEnter(e){e instanceof DragEvent&&(e.preventDefault(),this.el.classList.add("drag-over"),this.enter.emit(e))}onOver(e){e instanceof DragEvent&&(e.preventDefault(),this.over.emit(e))}onLeave(e){e instanceof DragEvent&&(e.preventDefault(),this.el.classList.remove("drag-over"),this.leave.emit(e))}onDrop(e){return U(this,null,function*(){if(e instanceof DragEvent){e.preventDefault(),this.el.classList.remove("drag-over");let n=e.dataTransfer?.files;if(n&&n.length){let i=Array.from(n),o=[];for(let m of i){let x=yield zn(m);x&&this.accept().includes(x)&&o.push(m)}this.files.emit(o)}}})}static \u0275fac=function(n){return new(n||t)};static \u0275dir=ee({type:t,selectors:[["","devmxDropZone",""]],hostBindings:function(n,i){n&1&&f("dragenter",function(m){return i.onEnter(m)})("dragover",function(m){return i.onOver(m)})("dragleave",function(m){return i.onLeave(m)})("drop",function(m){return i.onDrop(m)})},inputs:{accept:[1,"accept"]},outputs:{enter:"enter",over:"over",leave:"leave",files:"files"}})}return t})();var Hn=(()=>{class t{transform(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(2)} MB`:`${(e/(1024*1024*1024)).toFixed(2)} GB`}static \u0275fac=function(n){return new(n||t)};static \u0275pipe=mt({name:"fileSize",type:t,pure:!0})}return t})();function Un(t){return T((a,e)=>{let n=new FileReader;n.onload=()=>{typeof n.result=="string"&&a(n.result)},n.onerror=i=>{i instanceof Error?e(i):e(new Error("Falha ao carregar imagem"))},n.readAsDataURL(t)})}function jn(t,a=1280){return T((e,n)=>{Un(t).then(Fn).then(i=>{let o=document.createElement("canvas");o.width=a;let m=a/i.width;o.height=i.height*m;let x=o.getContext("2d");if(!x)throw n(new Error("Context error"));x.drawImage(i,0,0,o.width,o.height);let H="image/webp";o.toBlob(E=>{if(E){let{width:X,height:K}=o,Ae=new File([E],t.name,{type:H});e(Object.assign(Ae,{width:X,height:K}))}},H)})})}var Qe=class extends me{constructor(a){super({id:new A("",{nonNullable:!0}),data:new A("",{nonNullable:!0}),width:new A(0,{nonNullable:!0}),height:new A(0,{nonNullable:!0}),type:new A("image/webp",{nonNullable:!0})}),a&&this.patchValue(a)}},De=class extends ce{constructor(){super([])}add(a){this.push(new Qe(a))}};var Ze=class extends ce{constructor(){super([])}add(a){this.push(new bn(a))}},G=class extends me{constructor(){super({id:new A("",{nonNullable:!0}),title:new A(new Date().toLocaleDateString(),{nonNullable:!0,validators:[Et.required]}),contributors:new Ze,photos:new De})}get contributors(){return this.controls.contributors}patch(a){if(this.patchValue(a),a.contributors&&a.contributors.length>0)for(let e of a.contributors)this.contributors.add(e)}};var fi=(t,a)=>a.id,hi=()=>["image/jpeg","image/png","image/webp"];function gi(t,a){if(t&1){let e=v();s(0,"devmx-album-card",3)(1,"a",6),p(2,"devmx-icon",7),r(),s(3,"button",8),f("click",function(){let i=_(e).$implicit,o=h(2);return b(o.deleteAlbum(i))}),p(4,"devmx-icon",9),r()()}if(t&2){let e=a.$implicit;u("data",e),l(),u("routerLink",e.id)}}function _i(t,a){t&1&&(s(0,"div",4)(1,"h2"),c(2,"N\xE3o temos nada aqui..."),r(),s(3,"h3"),c(4," Siga nessa dire\xE7\xE3o "),p(5,"devmx-icon",10)(6,"br"),c(7," at\xE9 encontrar o bot\xE3o com um "),p(8,"devmx-icon",11)(9,"br"),c(10," e cadastre suas fotos. "),p(11,"devmx-icon",12),r()()),t&2&&(l(5),u("size",32),l(3),u("size",32),l(3),u("size",32))}function bi(t,a){if(t&1){let e=v();s(0,"div",2),f("files",function(i){_(e);let o=h();return b(o.onDropFiles(i))}),S(1,gi,5,2,"devmx-album-card",3,fi),r(),g(3,_i,12,3,"div",4),s(4,"footer")(5,"devmx-paginator",5),f("pageChange",function(i){_(e);let o=h();return b(o.onPageChange(i))}),r()()}if(t&2){let e=a;u("accept",ae(4,hi)),l(),P(e.data),l(2),M(e.items?-1:3),l(2),u("size",10)("items",e.items)}}var Nn=(()=>{class t{router=d(re);route=d(q);dialogFacade=d(we);authFacade=d(on);albumFacade=d(I);constructor(){let e=this.authFacade.auth$.pipe(L(i=>!!i),Y(({id:i})=>i)),n=this.route.queryParams.pipe(Y(({page:i,size:o,title:m})=>({page:i,size:o,title:m})));j([e,n]).pipe(_e()).subscribe(this.onQueryParams)}onQueryParams=([e,n])=>{let{page:i,size:o,title:m}=n,x={title:m,owner:e};this.albumFacade.setParams({page:i,size:o,filter:x}),this.albumFacade.load()};onDropFiles(e){console.log(e)}createAlbum(){let e=new G;e.patchValue({title:new Date().toLocaleDateString()}),this.albumFacade.create(e.getRawValue()).pipe(y(1)).subscribe(i=>{this.router.navigate([i.id],{relativeTo:this.route})})}deleteAlbum({id:e,title:n}){this.dialogFacade.confirm(`Confirme que deseja apagar a vaga ${n}`,"Esta a\xE7\xE3o n\xE3o poder\xE1 ser desfeita").subscribe(i=>{i&&this.albumFacade.delete(e)})}onPageChange({page:e,size:n}){let i={page:e,size:n};this.router.navigate([],{queryParams:i})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["devmx-admin-my-albums"]],decls:4,vars:3,consts:[["mat-fab","",1,"top","right","tertiary-fab",3,"click"],["name","plus"],["devmxDropZone","",1,"albums-container","drag-area",3,"files","accept"],[3,"data"],[1,"no-albums-yet"],[3,"pageChange","size","items"],["mat-icon-button","","matTooltip","Editar album","matTooltipPosition","above",3,"routerLink"],["name","software/edit"],["type","button","mat-icon-button","","matTooltip","Apagar album","matTooltipPosition","after",3,"click"],["name","trash-alt"],["color","#3BCE53","name","arrow/up-right",3,"size"],["color","#3BCE53","name","plus",3,"size"],["color","#3BCE53","name","emoji/smirking-alt",3,"size"]],template:function(n,i){if(n&1&&(s(0,"button",0),f("click",function(){return i.createAlbum()}),p(1,"devmx-icon",1),r(),g(2,bi,6,5),O(3,"async")),n&2){let o;l(2),M((o=D(3,1,i.albumFacade.response$))?2:-1,o)}},dependencies:[se,xt,R,Nt,B,jt,nn,tn,be,un,Oe,w,N],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-between}[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%]{gap:1em;padding:1em;display:flex;flex-flow:row wrap;justify-content:flex-start;grid-template-columns:repeat(2,1fr)}[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1;max-width:50%}[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:-webkit-box;line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}[_nghost-%COMP%]   .no-albums-yet[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]   .no-albums-yet[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   .no-albums-yet[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;padding:0;white-space:normal}[_nghost-%COMP%]   .no-albums-yet[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:160%}[_nghost-%COMP%]   .no-albums-yet[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:120%;text-align:end}[_nghost-%COMP%]   footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}@media (min-width: 1920px){[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1;max-width:33%}}@media (max-width: 767px){[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%]{align-content:flex-start;grid-template-columns:1fr}[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{display:inline-flex;min-width:100%}}[_nghost-%COMP%]   .add-button[_ngcontent-%COMP%]{position:fixed;right:4em;top:2em}"],changeDetection:0})}return t})();var xi=(t,a)=>a.photo.name;function Mi(t,a){if(t&1&&(s(0,"mat-list-item")(1,"span",2),c(2),O(3,"fileSize"),r(),s(4,"span",3),c(5),r(),p(6,"mat-progress-bar",4),r()),t&2){let e=a.$implicit;l(2),$(" ",D(3,3,e.photo.size)," "),l(3),$(" ",e.progress(),"% "),l(),u("value",e.progress())}}function vi(t,a){t&1&&c(0," Preparando imagens ")}function yi(t,a){t&1&&c(0," Enviando imagens ")}function wi(t,a){if(t&1&&(s(0,"mat-list-item")(1,"span",2),g(2,vi,1,0)(3,yi,1,0),r(),s(4,"span",3),c(5),r(),p(6,"mat-progress-bar",4),r()),t&2){let e=a;l(2),M(e<100?2:3),l(3),$(" ",e,"% "),l(),u("value",e)}}var qn=(()=>{class t{queue=V([]);opened=V(!1);resizing=V(0);total=gt(()=>this.queue().length);completed=V(0);constructor(){_t(()=>{let{length:e}=this.queue().filter(({progress:n})=>n()>=90);this.completed.set(e)})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["devmx-upload-queue"]],exportAs:["devmxUploadQueue"],decls:12,vars:5,consts:[[3,"expanded","hideToggle"],["name","arrow/chevron-down"],["matListItemTitle",""],["matListItemMeta",""],["mode","determinate",3,"value"]],template:function(n,i){if(n&1&&(s(0,"mat-expansion-panel",0)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),c(3," Enviando "),r(),s(4,"mat-panel-description"),c(5),p(6,"devmx-icon",1),r()(),s(7,"section")(8,"mat-list"),S(9,Mi,7,5,"mat-list-item",null,xi),g(11,wi,7,3,"mat-list-item"),r()()()),n&2){let o;u("expanded",i.opened())("hideToggle",!0),l(5),oe(" ",i.completed()," de ",i.total()," "),l(4),P(i.queue()),l(2),M((o=i.resizing())?11:-1,o)}},dependencies:[Ut,Ht,Yt,Zt,Gt,Kt,Xt,he,ue,fe,de,pe,w,Hn],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:18em;position:fixed;bottom:64px;right:12px}[_nghost-%COMP%]   .mat-expansion-panel-header-description[_ngcontent-%COMP%]{justify-content:space-between;align-items:center}[_nghost-%COMP%]     .mat-expansion-panel-content .mat-expansion-panel-body{padding:0}[_nghost-%COMP%]   section[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-end;max-height:80vh;overflow:auto}"],changeDetection:0})}return t})();var Si=(t,a)=>a.value;function Pi(t,a){if(t&1){let e=v();s(0,"mat-list-item"),p(1,"devmx-icon",6),s(2,"span",7),c(3),r(),s(4,"button",8),f("click",function(){let i=_(e).$index,o=h();return b(o.form.contributors.removeAt(i))}),p(5,"devmx-icon",9),r()()}if(t&2){let e=a.$implicit;l(3),k(e.value.displayName)}}var Qn=(()=>{class t extends Tn{form=new G;cdr=d(ht);selectUser=d(Se);ngOnInit(){this.data&&this.form.patch(this.data)}selectContributors(){this.selectUser.open({multiple:!0}).pipe(y(1)).subscribe(n=>{if(n){for(let i of n)this.form.contributors.add(i);this.cdr.detectChanges()}})}onSubmit(){if(this.form.valid){let e=this.form.getRawValue();return console.log(e),this.close(e)}return this.form.markAllAsTouched()}static \u0275fac=(()=>{let e;return function(i){return(e||(e=it(t)))(i||t)}})();static \u0275cmp=C({type:t,selectors:[["devmx-album-details"]],features:[ft([Pe()]),te],decls:19,vars:1,consts:[[3,"submit","formGroup"],["matInput","","formControlName","title"],["formArrayName","contributors"],["mat-subheader",""],["type","button","mat-button","",3,"click"],["mat-flat-button",""],["matListItemIcon","","name","user-circle"],["matListItemTitle",""],["type","button","mat-icon-button","","matListItemMeta","",3,"click"],["name","trash"]],template:function(n,i){n&1&&(s(0,"form",0),f("submit",function(){return i.onSubmit()}),s(1,"mat-form-field")(2,"mat-label"),c(3,"T\xEDtulo do album"),r(),p(4,"input",1),s(5,"mat-error"),c(6,"Obrigat\xF3rio"),r()(),s(7,"mat-list",2)(8,"p",3),c(9,"Contribuidores"),r(),S(10,Pi,6,1,"mat-list-item",null,Si),r(),s(12,"button",4),f("click",function(){return i.selectContributors()}),c(13," Permitir contribui\xE7\xE3o de outras pessoas "),r(),s(14,"footer")(15,"button",5),c(16,"Salvar"),r(),s(17,"button",4),f("click",function(){return i.close()}),c(18,"Fechar"),r()()()),n&2&&(u("formGroup",i.form),l(10),P(i.form.contributors.controls))},dependencies:[kn,Vt,Bt,Ft,kt,Tt,Rt,Lt,It,Ot,Pt,wt,St,R,ge,B,ln,sn,he,ue,fe,$t,zt,de,pe,w],styles:["[_nghost-%COMP%]{display:flex;padding:1.5em 1em .5em;flex-direction:column}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{flex:1;gap:1em;display:flex;flex-direction:column}[_nghost-%COMP%]   footer[_ngcontent-%COMP%]{margin-top:1em;display:flex;flex-direction:row-reverse;justify-content:space-between}"],changeDetection:0})}return t})();var Zn=(t,a)=>a.id,Oi=()=>["image/jpeg","image/png","image/webp","image/svg+xml"];function Di(t,a){if(t&1){let e=v();s(0,"figure"),p(1,"img",9),s(2,"figcaption"),c(3),r(),s(4,"mat-checkbox",10),f("change",function(i){let o=_(e).$implicit,m=h(2);return b(i?m.selection.toggle(o.id):null)}),r()()}if(t&2){let e=a.$implicit,n=h(2);l(),u("src",e.data,st)("alt",e.caption),l(2),k(e.caption),l(),u("checked",n.selection.isSelected(e.id))}}function Ai(t,a){if(t&1&&(s(0,"strong"),c(1),r()),t&2){let e=a.$implicit,n=a.$index,i=a.$count;l(),oe("",e.displayName,"",n===i-1?"":", ","")}}function Fi(t,a){if(t&1&&(s(0,"mat-card-content"),S(1,Ai,2,2,"strong",null,Zn),c(3," tem permiss\xE3o para contribuir neste album. "),r()),t&2){let e=h();l(),P(e.contributors)}}function Ei(t,a){if(t&1){let e=v();s(0,"mat-card",1)(1,"mat-card-header",2)(2,"mat-card-title"),c(3),r(),s(4,"mat-card-subtitle"),c(5),O(6,"date"),r(),s(7,"button",3),f("click",function(){let i=_(e),o=h();return b(o.editAlbum(i))}),p(8,"devmx-icon",4),r()(),s(9,"mat-card-actions",5)(10,"mat-checkbox",6),f("change",function(i){let o=_(e),m=h();return b(i?m.toggleAll(o.photos,m.selection.selected):null)}),r(),s(11,"button",7),f("click",function(){let i=_(e),o=h();return b(o.deleteSelection(o.selection.selected,i.id))}),c(12),r()(),s(13,"mat-card-content",8),f("files",function(i){let o=_(e),m=ut(18),x=h();return b(x.onDrop(o.id,i,m))}),S(14,Di,5,4,"figure",null,Zn),r(),g(16,Fi,4,0,"mat-card-content"),r(),p(17,"devmx-upload-queue",null,0)}if(t&2){let e=a,n=h();l(3),k(e.title),l(2),$(" Criado dia ",D(6,8,e.createdAt)," "),l(5),u("indeterminate",n.selection.hasValue()&&!n.isAllSelected(e.photos,n.selection.selected))("checked",n.selection.hasValue()&&n.isAllSelected(e.photos,n.selection.selected)),l(),u("disabled",n.selection.selected.length===0),l(),$(" Remover ",n.selection.selected.length," foto(s) "),l(),u("accept",ae(10,Oi)),l(),P(e.photos),l(2),M(e.contributors&&e.contributors.length>0?16:-1)}}var Gn=(()=>{class t{route=d(q);albumFacade=d(I);photoFacade=d(Wt);sheetFacade=d(Z);selection=new At(!0);onDrop(e,n,i){return U(this,null,function*(){let o=n.length*2,m=0;i.opened.set(!0);for(let E of n){m+=1,i.resizing.set(le(m,o));let X=V(0),K=yield jn(E,640);i.queue.set([...i.queue(),{photo:K,progress:X}]),m+=1,i.resizing.set(le(m,o))}let x=0,H=({photo:E,progress:X})=>{let K=({loaded:Yn,total:Wn,type:Ge})=>{Ge===Ee.UploadProgress&&X.set(le(Yn,Wn??E.size)),Ge===Ee.Response&&(x+=1,x>=i.total()&&this.albumFacade.loadOne(e))},{width:Ae,height:Xn}=E,Kn={album:e,width:Ae,height:Xn,photo:E};return this.photoFacade.upload(Kn).pipe(et(K))};Ye(i.queue()).pipe(Je(H)).subscribe()})}isAllSelected(e,n){return n.length===e.length}toggleAll(e,n){if(this.isAllSelected(e,n))return this.selection.clear();this.selection.select(...e.map(({id:i})=>i))}deleteSelection(e,n){j(e.map(i=>(this.selection.deselect(i),this.photoFacade.delete(i)))).subscribe(()=>this.albumFacade.loadOne(n))}editAlbum(e){this.sheetFacade.open(Qn,e).pipe(y(1)).subscribe(i=>{i&&this.albumFacade.update(i)})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["devmx-admin-album"]],decls:2,vars:3,consts:[["uploadQueue","devmxUploadQueue"],[1,"album-card"],[1,"album-card-header"],["mat-icon-button","",3,"click"],["name","software/edit"],[1,"album-card-actions"],[1,"photo-checkbox",3,"change","indeterminate","checked"],["color","warn","type","button","mat-flat-button","",3,"click","disabled"],["devmxDropZone","",1,"album-card-content","drag-area",3,"files","accept"],[3,"src","alt"],[1,"photo-checkbox",3,"change","checked"]],template:function(n,i){if(n&1&&(g(0,Ei,19,11),O(1,"async")),n&2){let o;M((o=D(1,1,i.albumFacade.selected$))?0:-1,o)}},dependencies:[qn,Oe,_n,gn,R,ge,B,ye,Ce,Me,an,ve,rn,xe,w,N,bt],styles:["[_nghost-%COMP%]{flex:1;padding:1em;display:flex;flex-direction:column}[_nghost-%COMP%]   .album-card[_ngcontent-%COMP%]{gap:1em}[_nghost-%COMP%]   .album-card-header[_ngcontent-%COMP%]{justify-content:space-between}[_nghost-%COMP%]   .album-card-header[_ngcontent-%COMP%]     .mat-mdc-card-header-text{flex:1;justify-self:flex-start}[_nghost-%COMP%]   .album-card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]{gap:1em;display:grid;grid-auto-flow:dense;grid-template-columns:repeat(4,1fr)}@media (max-width: 1918px){[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media (max-width: 1278px){[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 767px){[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]{grid-template-columns:repeat(1,1fr)}}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]{margin:0;box-sizing:border-box;border-radius:.4em;position:relative;overflow:hidden;background-color:#0000000a}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;display:flex;object-fit:cover;height:24em}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   figcaption[_ngcontent-%COMP%]{display:flex;width:100%;padding:.4em;position:absolute;bottom:0;background-color:#0006;color:#fff9;z-index:100}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   figcaption[_ngcontent-%COMP%]:empty{display:none}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   .photo-checkbox[_ngcontent-%COMP%]{background-color:#fff;position:absolute;border-radius:50%;opacity:0;right:1em;top:-2em;transition:top .25s ease-in-out,opacity .25s ease-in-out}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]:hover   .photo-checkbox[_ngcontent-%COMP%]{opacity:1;top:1em}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   .photo-checkbox.mat-mdc-checkbox-checked[_ngcontent-%COMP%]{opacity:1;top:1em}[_nghost-%COMP%]   .album-card-content.drag-area[_ngcontent-%COMP%]{min-height:32em;transition:box-shadow .28s cubic-bezier(.4,0,.2,1);transition:background-image .6s ease-in-out}[_nghost-%COMP%]   .album-card-content.drag-area.drag-over[_ngcontent-%COMP%]{box-shadow:0 2px 4px -1px #0003,0 4px 5px #00000024,0 1px 10px #0000001f;background-color:#fff6;background-image:url(/figures/drop-photos.svg);background-position:center center;background-repeat:no-repeat}"],changeDetection:0})}return t})();var Vr=[{path:"",data:{breadcrumb:"Administra\xE7\xE3o"},providers:Rn,component:En,children:[{path:"meus-albuns/:id",data:{breadcrumb:t=>t.album.title},resolve:{album:In},component:Gn},{path:"meus-albuns",data:{breadcrumb:"Meus albuns"},component:Nn},{path:"gerenciar-albuns",data:{breadcrumb:"Gerenciar albuns"},canActivate:[fn("director","manager","staff")],component:Ln},{path:"",pathMatch:"prefix",redirectTo:"meus-albuns"}]}];export{En as AlbumFeatureAdminComponent,Vr as albumFeatureAdminRoutes};
