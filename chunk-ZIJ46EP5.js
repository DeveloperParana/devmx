import{a as bn}from"./chunk-GDKEV453.js";import{a as kn}from"./chunk-KZU7HIDH.js";import{b as Yt,c as Wt,d as Jt,e as en,g as tn}from"./chunk-NJXNSQTG.js";import{a as Ue,b as ee}from"./chunk-6S2KI72K.js";import{a as dn,b as pn}from"./chunk-IBLKOITY.js";import{a as vn,b as yn,c as Sn,d as wn,e as Pn,f as On,g as An,h as Dn,i as Fn,j as Tn,k as En}from"./chunk-THHJ2DT2.js";import{a as je,b as Mn}from"./chunk-A7IEQXOQ.js";import{a as Cn}from"./chunk-EQDX552D.js";import{a as un}from"./chunk-SDGOOU6G.js";import"./chunk-SHICUOO6.js";import{a as L,b as nn,d as on}from"./chunk-4FBR3SYM.js";import{a as Be}from"./chunk-ERUAW4UO.js";import"./chunk-MFHZ6JZ7.js";import{a as qt,b as Qt}from"./chunk-T47JS64O.js";import"./chunk-MN2QX6OM.js";import"./chunk-M5O2VH4C.js";import"./chunk-XIUDFJWJ.js";import{g as G,h as Rt,i as he,j as Vt,p as _e}from"./chunk-I77QJBBK.js";import{g as gn,n as xn}from"./chunk-5D3ZBKU5.js";import"./chunk-MTK7EKDI.js";import{b as fn,e as hn,f as _n}from"./chunk-IQKXYVAO.js";import{a as rn,b as sn}from"./chunk-XOG3MR4O.js";import{a as cn}from"./chunk-FGIWLLTD.js";import{l as B,r as Me,t as Nt}from"./chunk-THCNWKDC.js";import{d as He,e as Ne}from"./chunk-SOKUPTDF.js";import{a as Z,c as X,e as Ee,f as K,g as Y,i as ke,l as W}from"./chunk-MVGT6HIX.js";import{a as Le,b as Re,c as mn,d as ln,e as Ve,f as $e,i as ze}from"./chunk-EKMWFXOB.js";import{b as ge,c as be,i as Ce,j as xe,o as an}from"./chunk-WLWXH53B.js";import{f as Xt,g as Kt}from"./chunk-ZA3WZWW5.js";import{a as v,c as ve,e as jt,h as ye,i as Se,j as we,l as k,m as Pe,p as Oe,r as Ae,s as De,w as Fe,x as Te,y as Ie}from"./chunk-57VKPFDS.js";import{Ba as Gt,D as Ht,E as H,Ea as A,Fa as Zt,Ga as D,W as rt,X as st,Y as mt,b as We,s as zt,xa as Ut,za as J}from"./chunk-XMIP7OAF.js";import{c as $t,d as Je,e as et,g as tt,h as nt,j as it,k as ot,l as at}from"./chunk-I7VYXJU2.js";import{Ac as z,Bc as pe,E as bt,Fa as yt,G as V,Gb as $,Ia as re,Ic as ue,J as Ct,Ja as St,Jc as fe,Ka as wt,Lb as q,M as y,Mc as T,Nc as E,Ob as b,Tb as Dt,Ub as u,Vc as kt,Zb as S,_c as It,a as se,ac as w,ad as Bt,b as ht,bc as P,ca as xt,cc as s,d as U,dc as r,ec as p,fa as Mt,fc as ce,ga as vt,gc as de,hb as Pt,ia as Ye,ic as M,j as _t,kc as Ft,la as d,lc as f,mb as m,mc as Tt,me as Q,nc as h,p as gt,se as Lt,u as ae,ua as _,v as j,va as g,vb as C,wb as Ot,xb as le,xc as Et,ya as me,yb as At,yc as l,zc as O}from"./chunk-FZSJMIDG.js";var In=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["devmx-album-feature-admin"]],decls:1,vars:0,template:function(n,i){n&1&&p(0,"router-outlet")},dependencies:[Rt],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column}"],changeDetection:0})}return t})();function ii(t,a){}var oi={bottomSheetState:$t("state",[nt("void, hidden",tt({transform:"translateY(100%)"})),nt("visible",tt({transform:"translateY(0%)"})),it("visible => void, visible => hidden",et([Je(`${st.COMPLEX} ${rt.ACCELERATION_CURVE}`),at("@*",ot(),{optional:!0})])),it("void => visible",et([Je(`${st.EXITING} ${rt.DECELERATION_CURVE}`),at("@*",ot(),{optional:!0})]))])},ai=(()=>{class t extends fn{_breakpointSubscription;_animationState="void";_animationStateChanged=new yt;_destroyed;constructor(){super();let e=d(Ht);this._breakpointSubscription=e.observe([H.Medium,H.Large,H.XLarge]).subscribe(()=>{let n=this._elementRef.nativeElement.classList;n.toggle("mat-bottom-sheet-container-medium",e.isMatched(H.Medium)),n.toggle("mat-bottom-sheet-container-large",e.isMatched(H.Large)),n.toggle("mat-bottom-sheet-container-xlarge",e.isMatched(H.XLarge))})}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges())}exit(){this._destroyed||(this._animationState="hidden",this._changeDetectorRef.markForCheck())}ngOnDestroy(){super.ngOnDestroy(),this._breakpointSubscription.unsubscribe(),this._destroyed=!0}_onAnimationDone(e){e.toState==="visible"&&this._trapFocus(),this._animationStateChanged.emit(e)}_onAnimationStart(e){this._animationStateChanged.emit(e)}_captureInitialFocus(){}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["mat-bottom-sheet-container"]],hostAttrs:["tabindex","-1",1,"mat-bottom-sheet-container"],hostVars:4,hostBindings:function(n,i){n&1&&Tt("@state.start",function(c){return i._onAnimationStart(c)})("@state.done",function(c){return i._onAnimationDone(c)}),n&2&&(Ft("@state",i._animationState),Dt("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-label",i._config.ariaLabel))},features:[q],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(n,i){n&1&&b(0,ii,0,0,"ng-template",0)},dependencies:[Xt],styles:[".mat-bottom-sheet-container{box-shadow:0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12);padding:8px 16px;min-width:100vw;box-sizing:border-box;display:block;outline:0;max-height:80vh;overflow:auto;background:var(--mat-bottom-sheet-container-background-color, var(--mat-sys-surface-container-low));color:var(--mat-bottom-sheet-container-text-color, var(--mat-sys-on-surface));font-family:var(--mat-bottom-sheet-container-text-font, var(--mat-sys-body-large-font));font-size:var(--mat-bottom-sheet-container-text-size, var(--mat-sys-body-large-size));line-height:var(--mat-bottom-sheet-container-text-line-height, var(--mat-sys-body-large-line-height));font-weight:var(--mat-bottom-sheet-container-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mat-bottom-sheet-container-text-tracking, var(--mat-sys-body-large-tracking))}@media(forced-colors: active){.mat-bottom-sheet-container{outline:1px solid}}.mat-bottom-sheet-container-xlarge,.mat-bottom-sheet-container-large,.mat-bottom-sheet-container-medium{border-top-left-radius:var(--mat-bottom-sheet-container-shape, 28px);border-top-right-radius:var(--mat-bottom-sheet-container-shape, 28px)}.mat-bottom-sheet-container-medium{min-width:384px;max-width:calc(100vw - 128px)}.mat-bottom-sheet-container-large{min-width:512px;max-width:calc(100vw - 256px)}.mat-bottom-sheet-container-xlarge{min-width:576px;max-width:calc(100vw - 384px)}"],encapsulation:2,data:{animation:[oi.bottomSheetState]}})}return t})(),ct=new Ye("MatBottomSheetData"),lt=class{viewContainerRef;panelClass;direction;data=null;hasBackdrop=!0;backdropClass;disableClose=!1;ariaLabel=null;ariaModal=!0;closeOnNavigation=!0;autoFocus="dialog";restoreFocus=!0;scrollStrategy;height="";minHeight;maxHeight},te=class{_ref;get instance(){return this._ref.componentInstance}get componentRef(){return this._ref.componentRef}containerInstance;disableClose;_afterOpened=new _t;_result;_closeFallbackTimeout;constructor(a,e,n){this._ref=a,this.containerInstance=n,this.disableClose=e.disableClose,n._animationStateChanged.pipe(V(i=>i.phaseName==="done"&&i.toState==="visible"),y(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),n._animationStateChanged.pipe(V(i=>i.phaseName==="done"&&i.toState==="hidden"),y(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._ref.close(this._result)}),a.overlayRef.detachments().subscribe(()=>{this._ref.close(this._result)}),bt(this.backdropClick(),this.keydownEvents().pipe(V(i=>i.keyCode===27))).subscribe(i=>{!this.disableClose&&(i.type!=="keydown"||!zt(i))&&(i.preventDefault(),this.dismiss())})}dismiss(a){this.containerInstance&&(this.containerInstance._animationStateChanged.pipe(V(e=>e.phaseName==="start"),y(1)).subscribe(e=>{this._closeFallbackTimeout=setTimeout(()=>{this._ref.close(this._result)},e.totalTime+100),this._ref.overlayRef.detachBackdrop()}),this._result=a,this.containerInstance.exit(),this.containerInstance=null)}afterDismissed(){return this._ref.closed}afterOpened(){return this._afterOpened}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}},ri=new Ye("mat-bottom-sheet-default-options"),dt=(()=>{class t{_overlay=d(an);_parentBottomSheet=d(t,{optional:!0,skipSelf:!0});_defaultOptions=d(ri,{optional:!0});_bottomSheetRefAtThisLevel=null;_dialog=d(hn);get _openedBottomSheetRef(){let e=this._parentBottomSheet;return e?e._openedBottomSheetRef:this._bottomSheetRefAtThisLevel}set _openedBottomSheetRef(e){this._parentBottomSheet?this._parentBottomSheet._openedBottomSheetRef=e:this._bottomSheetRefAtThisLevel=e}constructor(){}open(e,n){let i=se(se({},this._defaultOptions||new lt),n),o;return this._dialog.open(e,ht(se({},i),{disableClose:!0,closeOnOverlayDetachments:!1,maxWidth:"100%",container:ai,scrollStrategy:i.scrollStrategy||this._overlay.scrollStrategies.block(),positionStrategy:this._overlay.position().global().centerHorizontally().bottom("0"),templateContext:()=>({bottomSheetRef:o}),providers:(c,x,N)=>(o=new te(c,i,N),[{provide:te,useValue:o},{provide:ct,useValue:i.data}])})),o.afterDismissed().subscribe(()=>{this._openedBottomSheetRef===o&&(this._openedBottomSheetRef=null)}),this._openedBottomSheetRef?(this._openedBottomSheetRef.afterDismissed().subscribe(()=>o.containerInstance?.enter()),this._openedBottomSheetRef.dismiss()):o.containerInstance.enter(),this._openedBottomSheetRef=o,o}dismiss(e){this._openedBottomSheetRef&&this._openedBottomSheetRef.dismiss(e)}ngOnDestroy(){this._bottomSheetRefAtThisLevel&&this._bottomSheetRefAtThisLevel.dismiss()}static \u0275fac=function(n){return new(n||t)};static \u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),qe=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=Ot({type:t});static \u0275inj=vt({providers:[dt],imports:[_n,mt,Kt,mt]})}return t})();var Qe=(()=>{class t{ref=d(te);data=d(ct);close(e){this.ref.dismiss(e)}static \u0275fac=function(n){return new(n||t)};static \u0275dir=le({type:t})}return t})();var R=class{sheet;constructor(a){this.sheet=a}open(a,e){return this.sheet.open(a,{data:e,autoFocus:!0,restoreFocus:!0,panelClass:"devmx-sheet"}).afterDismissed()}};function Bn(){return{provide:R,deps:[dt]}}var Ln=[ee(),Mn(),Bn()];var Rn=t=>on(d(L),t.params);function mi(t,a){t&1&&(s(0,"th",15),l(1,"T\xEDtulo do album"),r())}function li(t,a){if(t&1&&(s(0,"td",16),l(1),r()),t&2){let e=a.$implicit;m(),O(e.title)}}function ci(t,a){t&1&&(s(0,"th",15),l(1,"Criado por"),r())}function di(t,a){if(t&1&&(s(0,"td",16),l(1),r()),t&2){let e=a.$implicit;m(),O(e.owner.displayName)}}function pi(t,a){t&1&&p(0,"th",15)}function ui(t,a){if(t&1){let e=M();s(0,"td",16)(1,"button",17),f("click",function(){let i=_(e).$implicit,o=h(2);return g(o.openDelete(i))}),p(2,"devmx-icon",18),r()()}}function fi(t,a){t&1&&p(0,"tr",19)}function hi(t,a){t&1&&p(0,"tr",20)}function _i(t,a){if(t&1){let e=M();s(0,"table",5),ce(1,6),b(2,mi,2,0,"th",7)(3,li,2,1,"td",8),de(),ce(4,9),b(5,ci,2,0,"th",7)(6,di,2,1,"td",8),de(),ce(7,10),b(8,pi,1,0,"th",7)(9,ui,3,0,"td",8),de(),b(10,fi,1,0,"tr",11)(11,hi,1,0,"tr",12),r(),s(12,"mat-card-actions",13)(13,"devmx-paginator",14),f("pageChange",function(i){_(e);let o=h();return g(o.onPageChange(i))}),r()()}if(t&2){let e=a,n=h();u("dataSource",e.data),m(10),u("matHeaderRowDef",n.columns),m(),u("matRowDefColumns",n.columns),m(2),u("size",10)("items",e.items)}}var Vn=(()=>{class t{router=d(he);route=d(G);dialogFacade=d(je);albumFacade=d(L);selectUser=d(Ue);#e=Nt(null);columns=["title","owner","actions"];constructor(){let e=this.#e.observe().pipe(ae(i=>i?i.id:"")),n=this.route.queryParams;j([e,n]).pipe(Ie()).subscribe(this.onQueryParams)}onQueryParams=([e,n])=>{let{page:i=0,size:o=10}=n,c={title:"",owner:e};this.albumFacade.setParams({page:i,size:o,filter:c}),this.albumFacade.load()};openDelete({id:e,title:n}){this.dialogFacade.confirm(`Confirme que deseja apagar o album ${n}`,"Esta a\xE7\xE3o n\xE3o poder\xE1 ser desfeita").subscribe(i=>{i&&this.albumFacade.delete(e)})}openSelectUser(){this.selectUser.open({multiple:!1}).subscribe(e=>{e&&this.#e.update(e)})}onSearchChange(e=""){this.albumFacade.setFilter({title:e}),this.albumFacade.load()}onPageChange({page:e,size:n}){let i={page:e,size:n};this.router.navigate([],{queryParams:i})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["devmx-album-admin-manage-albums"]],decls:10,vars:4,consts:[[1,"albums-card"],[1,"albums-card-header"],["mat-icon-button","",3,"click"],["name","filter"],[3,"searchChange","debounce"],["mat-table","",3,"dataSource"],["matColumnDef","title"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","owner"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["align","end"],[3,"pageChange","size","items"],["mat-header-cell",""],["mat-cell",""],["type","button","mat-icon-button","",3,"click"],["name","trash"],["mat-header-row",""],["mat-row",""]],template:function(n,i){if(n&1&&(s(0,"mat-card",0)(1,"mat-card-header",1)(2,"mat-card-title"),l(3,"Albuns"),r(),s(4,"div")(5,"button",2),f("click",function(){return i.openSelectUser()}),p(6,"devmx-icon",3),r(),s(7,"devmx-search-field",4),f("searchChange",function(c){return i.onSearchChange(c)}),r()()(),b(8,_i,14,5),T(9,"async"),r()),n&2){let o;m(7),u("debounce",1e3),m(),S((o=E(9,2,i.albumFacade.response$))?8:-1,o)}},dependencies:[_e,D,A,Cn,Be,En,vn,Sn,An,wn,yn,Dn,Pn,On,Fn,Tn,ze,Le,Ve,$e,Re,v,Q],styles:["[_nghost-%COMP%]{flex:1;padding:1em;display:flex;flex-direction:column}[_nghost-%COMP%]   .albums-card[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .albums-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;border-bottom:1px dashed rgba(0,0,0,.1)}[_nghost-%COMP%]   .albums-card-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{gap:2em;display:flex;align-items:baseline}[_nghost-%COMP%]   .mat-mdc-table[_ngcontent-%COMP%]   .mat-column-actions[_ngcontent-%COMP%]{max-width:3em}"],changeDetection:0})}return t})();function $n(t){return B((a,e)=>{let n=new FileReader;n.onload=()=>{n.result instanceof ArrayBuffer&&a(n.result)},n.onerror=()=>{e(new Error("Falha ao ler ArrayBuffer"))},n.readAsArrayBuffer(t)})}function zn(t){return"0x"+parseInt(`${t}`).toString(16)}function Hn(t){return B(a=>U(this,null,function*(){let e=t.slice(0,4),n=yield $n(e),o=new DataView(n).getUint32(0,!1);switch(console.log(zn(o)),o){case 2303741511:return a("image/png");case 1195984440:return a("image/gif");case 1380533830:return a("image/webp");case 1014199911:return a("image/svg+xml");case 4292411360:case 4292411361:case 4292411374:return a("image/jpeg");default:return a(null)}}))}var Ze=(()=>{class t{elRef=d(wt);get el(){return this.elRef.nativeElement}accept=St([]);enter=re();over=re();leave=re();files=re();onEnter(e){e instanceof DragEvent&&(e.preventDefault(),this.el.classList.add("drag-over"),this.enter.emit(e))}onOver(e){e instanceof DragEvent&&(e.preventDefault(),this.over.emit(e))}onLeave(e){e instanceof DragEvent&&(e.preventDefault(),this.el.classList.remove("drag-over"),this.leave.emit(e))}onDrop(e){return U(this,null,function*(){if(e instanceof DragEvent){e.preventDefault(),this.el.classList.remove("drag-over");let n=e.dataTransfer?.files;if(n&&n.length){let i=Array.from(n),o=[];for(let c of i){let x=yield Hn(c);x&&this.accept().includes(x)&&o.push(c)}this.files.emit(o)}}})}static \u0275fac=function(n){return new(n||t)};static \u0275dir=le({type:t,selectors:[["","devmxDropZone",""]],hostBindings:function(n,i){n&1&&f("dragenter",function(c){return i.onEnter(c)})("dragover",function(c){return i.onOver(c)})("dragleave",function(c){return i.onLeave(c)})("drop",function(c){return i.onDrop(c)})},inputs:{accept:[1,"accept"]},outputs:{enter:"enter",over:"over",leave:"leave",files:"files"}})}return t})();var Nn=(()=>{class t{transform(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(2)} MB`:`${(e/(1024*1024*1024)).toFixed(2)} GB`}static \u0275fac=function(n){return new(n||t)};static \u0275pipe=At({name:"fileSize",type:t,pure:!0})}return t})();function Un(t){return B((a,e)=>{let n=new FileReader;n.onload=()=>{typeof n.result=="string"&&a(n.result)},n.onerror=i=>{i instanceof Error?e(i):e(new Error("Falha ao carregar imagem"))},n.readAsDataURL(t)})}function jn(t,a=1280){return B((e,n)=>{Un(t).then(kn).then(i=>{let o=document.createElement("canvas");o.width=a;let c=a/i.width;o.height=i.height*c;let x=o.getContext("2d");if(!x)throw n(new Error("Context error"));x.drawImage(i,0,0,o.width,o.height);let N="image/webp";o.toBlob(I=>{if(I){let{width:ie,height:oe}=o,Ke=new File([I],t.name,{type:N});e(Object.assign(Ke,{width:ie,height:oe}))}},N)})})}var pt=class extends we{constructor(a){super({id:new k("",{nonNullable:!0}),data:new k("",{nonNullable:!0}),width:new k(0,{nonNullable:!0}),height:new k(0,{nonNullable:!0}),type:new k("image/webp",{nonNullable:!0})}),a&&this.patchValue(a)}},Xe=class extends Fe{constructor(){super([])}add(a){this.push(new pt(a))}};var ut=class extends Fe{constructor(){super([])}add(a){this.push(new bn(a))}},ne=class extends we{constructor(){super({id:new k("",{nonNullable:!0}),title:new k("",{nonNullable:!0,validators:[jt.required]}),contributors:new ut,photos:new Xe})}get contributors(){return this.controls.contributors}patch(a){if(this.patchValue(a),a.contributors&&a.contributors.length>0)for(let e of a.contributors)this.contributors.add(e)}};var xi=(t,a)=>a.value;function Mi(t,a){if(t&1){let e=M();s(0,"mat-list-item"),p(1,"devmx-icon",6),s(2,"span",7),l(3),r(),s(4,"button",8),f("click",function(){let i=_(e).$index,o=h();return g(o.form.contributors.removeAt(i))}),p(5,"devmx-icon",9),r()()}if(t&2){let e=a.$implicit;m(3),O(e.value.displayName)}}var Qn=(()=>{class t extends Qe{form=new ne;cdr=d(kt);selectUser=d(Ue);ngOnInit(){this.data&&this.form.patch(this.data)}selectContributors(){this.selectUser.open({multiple:!0}).pipe(y(1)).subscribe(n=>{if(n){for(let i of n)this.form.contributors.add(i);this.cdr.detectChanges()}})}onSubmit(){if(this.form.valid){let e=this.form.getRawValue();return console.log(e),this.close(e)}return this.form.markAllAsTouched()}static \u0275fac=(()=>{let e;return function(i){return(e||(e=me(t)))(i||t)}})();static \u0275cmp=C({type:t,selectors:[["devmx-album-details"]],features:[ue([ee()]),q],decls:19,vars:1,consts:[[3,"submit","formGroup"],["matInput","","formControlName","title"],["formArrayName","contributors"],["mat-subheader",""],["type","button","mat-button","",3,"click"],["mat-flat-button",""],["matListItemIcon","","name","user-circle"],["matListItemTitle",""],["type","button","mat-icon-button","","matListItemMeta","",3,"click"],["name","trash"]],template:function(n,i){n&1&&(s(0,"form",0),f("submit",function(){return i.onSubmit()}),s(1,"mat-form-field")(2,"mat-label"),l(3,"T\xEDtulo do album"),r(),p(4,"input",1),s(5,"mat-error"),l(6,"Obrigat\xF3rio"),r()(),s(7,"mat-list",2)(8,"p",3),l(9,"Contribuidores"),r(),w(10,Mi,6,1,"mat-list-item",null,xi),r(),s(12,"button",4),f("click",function(){return i.selectContributors()}),l(13," Permitir contribui\xE7\xE3o de outras pessoas "),r(),s(14,"footer")(15,"button",5),l(16,"Salvar"),r(),s(17,"button",4),f("click",function(){return i.close()}),l(18,"Fechar"),r()()()),n&2&&(u("formGroup",i.form),m(10),P(i.form.contributors.controls))},dependencies:[qe,Te,Pe,ve,ye,Se,Oe,De,Ae,xe,Ce,ge,be,D,J,A,Ne,He,W,K,Y,Ee,ke,Z,X,v],styles:["[_nghost-%COMP%]{display:flex;padding:1.5em 1em .5em;flex-direction:column}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{flex:1;gap:1em;display:flex;flex-direction:column}[_nghost-%COMP%]   footer[_ngcontent-%COMP%]{margin-top:1em;display:flex;flex-direction:row-reverse;justify-content:space-between}"],changeDetection:0})}return t})();var vi=(t,a)=>a.value;function yi(t,a){if(t&1){let e=M();s(0,"mat-list-item"),p(1,"devmx-icon",7),s(2,"span",8),l(3),r(),s(4,"button",9),f("click",function(){let i=_(e).$index,o=h();return g(o.form.contributors.removeAt(i))}),p(5,"devmx-icon",10),r()()}if(t&2){let e=a.$implicit;m(3),O(e.value.displayName)}}var Gn=(()=>{class t extends Qe{form=new ne;ngOnInit(){this.data&&this.form.patch(this.data)}onContributorSelected(e){this.form.contributors.add(e)}onSubmit(){return this.form.valid?this.close(this.form.getRawValue()):this.form.markAllAsTouched()}static \u0275fac=(()=>{let e;return function(i){return(e||(e=me(t)))(i||t)}})();static \u0275cmp=C({type:t,selectors:[["devmx-create-album"]],features:[ue([ee()]),q],decls:18,vars:1,consts:[[3,"submit","formGroup"],["matInput","","formControlName","title"],["formArrayName","contributors"],["mat-subheader",""],["label","Encontre um contribuidor","hint","Contribuidores tamb\xE9m podem editar o album",3,"selected"],["mat-flat-button",""],["type","button","mat-button","",3,"click"],["matListItemIcon","","name","user-circle"],["matListItemTitle",""],["type","button","mat-icon-button","","matListItemMeta","",3,"click"],["name","trash"]],template:function(n,i){n&1&&(s(0,"form",0),f("submit",function(){return i.onSubmit()}),s(1,"mat-form-field")(2,"mat-label"),l(3,"T\xEDtulo do album"),r(),p(4,"input",1),s(5,"mat-error"),l(6,"Obrigat\xF3rio"),r()(),s(7,"mat-list",2)(8,"p",3),l(9,"Contribuidores"),r(),w(10,yi,6,1,"mat-list-item",null,vi),r(),s(12,"devmx-search-user",4),f("selected",function(c){return i.onContributorSelected(c)}),r(),s(13,"footer")(14,"button",5),l(15,"Salvar"),r(),s(16,"button",6),f("click",function(){return i.close()}),l(17,"Fechar"),r()()()),n&2&&(u("formGroup",i.form),m(10),P(i.form.contributors.controls))},dependencies:[gn,qe,Te,Pe,ve,ye,Se,Oe,De,Ae,xe,Ce,ge,be,D,J,A,Ne,He,W,K,Y,Ee,ke,Z,X,v],styles:["[_nghost-%COMP%]{display:flex;padding:1.5em 1em .5em;flex-direction:column}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{flex:1;gap:1em;display:flex;flex-direction:column}[_nghost-%COMP%]   footer[_ngcontent-%COMP%]{margin-top:1em;display:flex;flex-direction:row-reverse;justify-content:space-between}"],changeDetection:0})}return t})();var Si=(t,a)=>a.id,wi=()=>["image/jpeg","image/png","image/webp"];function Pi(t,a){if(t&1){let e=M();s(0,"devmx-album-card",3)(1,"a",6),p(2,"devmx-icon",7),r(),s(3,"button",8),f("click",function(){let i=_(e).$implicit,o=h(2);return g(o.deleteAlbum(i))}),p(4,"devmx-icon",9),r()()}if(t&2){let e=a.$implicit;u("data",e),m(),u("routerLink",e.id)}}function Oi(t,a){t&1&&(s(0,"div",4)(1,"h2"),l(2,"N\xE3o temos nada aqui..."),r(),s(3,"h3"),l(4," Siga nessa dire\xE7\xE3o "),p(5,"devmx-icon",10)(6,"br"),l(7," at\xE9 encontrar o bot\xE3o com um "),p(8,"devmx-icon",11)(9,"br"),l(10," e cadastre suas fotos. "),p(11,"devmx-icon",12),r()()),t&2&&(m(5),u("size",32),m(3),u("size",32),m(3),u("size",32))}function Ai(t,a){if(t&1){let e=M();s(0,"div",2),f("files",function(i){_(e);let o=h();return g(o.onDropFiles(i))}),w(1,Pi,5,2,"devmx-album-card",3,Si),r(),b(3,Oi,12,3,"div",4),s(4,"footer")(5,"devmx-paginator",5),f("pageChange",function(i){_(e);let o=h();return g(o.onPageChange(i))}),r()()}if(t&2){let e=a;u("accept",fe(4,wi)),m(),P(e.data),m(2),S(e.items?-1:3),m(2),u("size",10)("items",e.items)}}var Zn=(()=>{class t{router=d(he);route=d(G);dialogFacade=d(je);sheetFacade=d(R);authFacade=d(cn);albumFacade=d(L);constructor(){let e=this.authFacade.auth$.pipe(V(i=>!!i),ae(({id:i})=>i)),n=this.route.queryParams.pipe(ae(({page:i,size:o,title:c})=>({page:i,size:o,title:c})));j([e,n]).pipe(Ie()).subscribe(this.onQueryParams)}onQueryParams=([e,n])=>{let{page:i,size:o,title:c}=n,x={title:c,owner:e};this.albumFacade.setParams({page:i,size:o,filter:x}),this.albumFacade.load()};onDropFiles(e){console.log(e)}createAlbum(){this.sheetFacade.open(Gn).pipe(y(1)).subscribe(e=>{e&&this.albumFacade.create(e).pipe(y(1)).subscribe(i=>{this.router.navigate([i.id],{relativeTo:this.route})})})}deleteAlbum({id:e,title:n}){this.dialogFacade.confirm(`Confirme que deseja apagar a vaga ${n}`,"Esta a\xE7\xE3o n\xE3o poder\xE1 ser desfeita").subscribe(i=>{i&&this.albumFacade.delete(e)})}onPageChange({page:e,size:n}){let i={page:e,size:n};this.router.navigate([],{queryParams:i})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["devmx-admin-my-albums"]],decls:4,vars:3,consts:[["mat-fab","",1,"top","right","tertiary-fab",3,"click"],["name","plus"],["devmxDropZone","",1,"albums-container","drag-area",3,"files","accept"],[3,"data"],[1,"no-albums-yet"],[3,"pageChange","size","items"],["mat-icon-button","","matTooltip","Editar album","matTooltipPosition","above",3,"routerLink"],["name","software/edit"],["type","button","mat-icon-button","","matTooltip","Apagar album","matTooltipPosition","after",3,"click"],["name","trash-alt"],["color","#3BCE53","name","arrow/up-right",3,"size"],["color","#3BCE53","name","plus",3,"size"],["color","#3BCE53","name","emoji/smirking-alt",3,"size"]],template:function(n,i){if(n&1&&(s(0,"button",0),f("click",function(){return i.createAlbum()}),p(1,"devmx-icon",1),r(),b(2,Ai,6,5),T(3,"async")),n&2){let o;m(2),S((o=E(3,1,i.albumFacade.response$))?2:-1,o)}},dependencies:[_e,Vt,D,Zt,A,Gt,sn,rn,Be,xn,Ze,v,Q],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-between}[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%]{gap:1em;padding:1em;display:flex;flex-flow:row wrap;justify-content:flex-start;grid-template-columns:repeat(2,1fr)}[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1;max-width:50%}[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:-webkit-box;line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}[_nghost-%COMP%]   .no-albums-yet[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]   .no-albums-yet[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   .no-albums-yet[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;padding:0;white-space:normal}[_nghost-%COMP%]   .no-albums-yet[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:160%}[_nghost-%COMP%]   .no-albums-yet[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:120%;text-align:end}[_nghost-%COMP%]   footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}@media (min-width: 1920px){[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1;max-width:33%}}@media (max-width: 767px){[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%]{align-content:flex-start;grid-template-columns:1fr}[_nghost-%COMP%]   .albums-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{display:inline-flex;min-width:100%}}[_nghost-%COMP%]   .add-button[_ngcontent-%COMP%]{position:fixed;right:4em;top:2em}"],changeDetection:0})}return t})();var Di=(t,a)=>a.photo.name;function Fi(t,a){if(t&1&&(s(0,"mat-list-item")(1,"span",2),l(2),T(3,"fileSize"),r(),s(4,"span",3),l(5),r(),p(6,"mat-progress-bar",4),r()),t&2){let e=a.$implicit;m(2),z(" ",E(3,3,e.photo.size)," "),m(3),z(" ",e.progress(),"% "),m(),u("value",e.progress())}}function Ti(t,a){t&1&&l(0," Preparando imagens ")}function Ei(t,a){t&1&&l(0," Enviando imagens ")}function ki(t,a){if(t&1&&(s(0,"mat-list-item")(1,"span",2),b(2,Ti,1,0)(3,Ei,1,0),r(),s(4,"span",3),l(5),r(),p(6,"mat-progress-bar",4),r()),t&2){let e=a;m(2),S(e<100?2:3),m(3),z(" ",e,"% "),m(),u("value",e)}}var Xn=(()=>{class t{queue=$([]);opened=$(!1);resizing=$(0);total=It(()=>this.queue().length);completed=$(0);constructor(){Bt(()=>{let{length:e}=this.queue().filter(({progress:n})=>n()>=90);this.completed.set(e)})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["devmx-upload-queue"]],exportAs:["devmxUploadQueue"],decls:12,vars:5,consts:[[3,"expanded","hideToggle"],["name","arrow/chevron-down"],["matListItemTitle",""],["matListItemMeta",""],["mode","determinate",3,"value"]],template:function(n,i){if(n&1&&(s(0,"mat-expansion-panel",0)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),l(3," Enviando "),r(),s(4,"mat-panel-description"),l(5),p(6,"devmx-icon",1),r()(),s(7,"section")(8,"mat-list"),w(9,Fi,7,5,"mat-list-item",null,Di),b(11,ki,7,3,"mat-list-item"),r()()()),n&2){let o;u("expanded",i.opened())("hideToggle",!0),m(5),pe(" ",i.completed()," de ",i.total()," "),m(4),P(i.queue()),m(2),S((o=i.resizing())?11:-1,o)}},dependencies:[Qt,qt,tn,Yt,Wt,en,Jt,W,K,Y,Z,X,v,Nn],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:18em;position:fixed;bottom:64px;right:12px}[_nghost-%COMP%]   .mat-expansion-panel-header-description[_ngcontent-%COMP%]{justify-content:space-between;align-items:center}[_nghost-%COMP%]     .mat-expansion-panel-content .mat-expansion-panel-body{padding:0}[_nghost-%COMP%]   section[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-end;max-height:80vh;overflow:auto}"],changeDetection:0})}return t})();var Kn=(t,a)=>a.id,Ii=()=>["image/jpeg","image/png","image/webp","image/svg+xml"];function Bi(t,a){if(t&1){let e=M();s(0,"figure"),p(1,"img",9),s(2,"figcaption"),l(3),r(),s(4,"mat-checkbox",10),f("change",function(i){let o=_(e).$implicit,c=h(2);return g(i?c.selection.toggle(o.id):null)}),r()()}if(t&2){let e=a.$implicit,n=h(2);m(),u("src",e.data,Pt)("alt",e.caption),m(2),O(e.caption),m(),u("checked",n.selection.isSelected(e.id))}}function Li(t,a){if(t&1&&(s(0,"strong"),l(1),r()),t&2){let e=a.$implicit,n=a.$index,i=a.$count;m(),pe("",e.displayName,"",n===i-1?"":", ","")}}function Ri(t,a){if(t&1&&(s(0,"mat-card-content"),w(1,Li,2,2,"strong",null,Kn),l(3," tem permiss\xE3o para contribuir neste album. "),r()),t&2){let e=h();m(),P(e.contributors)}}function Vi(t,a){if(t&1){let e=M();s(0,"mat-card",1)(1,"mat-card-header",2)(2,"mat-card-title"),l(3),r(),s(4,"mat-card-subtitle"),l(5),T(6,"date"),r(),s(7,"button",3),f("click",function(){let i=_(e),o=h();return g(o.editAlbum(i))}),p(8,"devmx-icon",4),r()(),s(9,"mat-card-actions",5)(10,"mat-checkbox",6),f("change",function(i){let o=_(e),c=h();return g(i?c.toggleAll(o.photos,c.selection.selected):null)}),r(),s(11,"button",7),f("click",function(){let i=_(e),o=h();return g(o.deleteSelection(o.selection.selected,i.id))}),l(12),r()(),s(13,"mat-card-content",8),f("files",function(i){let o=_(e),c=Et(18),x=h();return g(x.onDrop(o.id,i,c))}),w(14,Bi,5,4,"figure",null,Kn),r(),b(16,Ri,4,0,"mat-card-content"),r(),p(17,"devmx-upload-queue",null,0)}if(t&2){let e=a,n=h();m(3),O(e.title),m(2),z(" Criado dia ",E(6,8,e.createdAt)," "),m(5),u("indeterminate",n.selection.hasValue()&&!n.isAllSelected(e.photos,n.selection.selected))("checked",n.selection.hasValue()&&n.isAllSelected(e.photos,n.selection.selected)),m(),u("disabled",n.selection.selected.length===0),m(),z(" Remover ",n.selection.selected.length," foto(s) "),m(),u("accept",fe(10,Ii)),m(),P(e.photos),m(2),S(e.contributors&&e.contributors.length>0?16:-1)}}var Yn=(()=>{class t{route=d(G);albumFacade=d(L);photoFacade=d(nn);sheetFacade=d(R);selection=new Ut(!0);onDrop(e,n,i){return U(this,null,function*(){let o=n.length*2,c=0;i.opened.set(!0);for(let I of n){c+=1,i.resizing.set(Me(c,o));let ie=$(0),oe=yield jn(I,640);i.queue.set([...i.queue(),{photo:oe,progress:ie}]),c+=1,i.resizing.set(Me(c,o))}let x=0,N=({photo:I,progress:ie})=>{let oe=({loaded:ei,total:ti,type:ft})=>{ft===We.UploadProgress&&ie.set(Me(ei,ti??I.size)),ft===We.Response&&(x+=1,x>=i.total()&&this.albumFacade.loadOne(e))},{width:Ke,height:Wn}=I,Jn={album:e,width:Ke,height:Wn,photo:I};return this.photoFacade.upload(Jn).pipe(xt(oe))};gt(i.queue()).pipe(Ct(N)).subscribe()})}isAllSelected(e,n){return n.length===e.length}toggleAll(e,n){if(this.isAllSelected(e,n))return this.selection.clear();this.selection.select(...e.map(({id:i})=>i))}deleteSelection(e,n){j(e.map(i=>(this.selection.deselect(i),this.photoFacade.delete(i)))).subscribe(()=>this.albumFacade.loadOne(n))}editAlbum(e){this.sheetFacade.open(Qn,e).pipe(y(1)).subscribe(i=>{i&&this.albumFacade.update(i)})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=C({type:t,selectors:[["devmx-admin-album"]],decls:2,vars:3,consts:[["uploadQueue","devmxUploadQueue"],[1,"album-card"],[1,"album-card-header"],["mat-icon-button","",3,"click"],["name","software/edit"],[1,"album-card-actions"],[1,"photo-checkbox",3,"change","indeterminate","checked"],["color","warn","type","button","mat-flat-button","",3,"click","disabled"],["devmxDropZone","",1,"album-card-content","drag-area",3,"files","accept"],[3,"src","alt"],[1,"photo-checkbox",3,"change","checked"]],template:function(n,i){if(n&1&&(b(0,Vi,19,11),T(1,"async")),n&2){let o;S((o=E(1,1,i.albumFacade.selected$))?0:-1,o)}},dependencies:[Xn,Ze,pn,dn,D,J,A,ze,Le,Ve,mn,$e,ln,Re,v,Q,Lt],styles:["[_nghost-%COMP%]{flex:1;padding:1em;display:flex;flex-direction:column}[_nghost-%COMP%]   .album-card[_ngcontent-%COMP%]{gap:1em}[_nghost-%COMP%]   .album-card-header[_ngcontent-%COMP%]{justify-content:space-between}[_nghost-%COMP%]   .album-card-header[_ngcontent-%COMP%]     .mat-mdc-card-header-text{flex:1;justify-self:flex-start}[_nghost-%COMP%]   .album-card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]{gap:1em;display:grid;grid-auto-flow:dense;grid-template-columns:repeat(4,1fr)}@media (max-width: 1918px){[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media (max-width: 1278px){[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 767px){[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]{grid-template-columns:repeat(1,1fr)}}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]{margin:0;box-sizing:border-box;border-radius:.4em;position:relative;overflow:hidden;background-color:#0000000a}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;display:flex;object-fit:cover;height:24em}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   figcaption[_ngcontent-%COMP%]{display:flex;width:100%;padding:.4em;position:absolute;bottom:0;background-color:#0006;color:#fff9;z-index:100}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   figcaption[_ngcontent-%COMP%]:empty{display:none}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   .photo-checkbox[_ngcontent-%COMP%]{background-color:#fff;position:absolute;border-radius:50%;opacity:0;right:1em;top:-2em;transition:top .25s ease-in-out,opacity .25s ease-in-out}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]:hover   .photo-checkbox[_ngcontent-%COMP%]{opacity:1;top:1em}[_nghost-%COMP%]   .album-card-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   .photo-checkbox.mat-mdc-checkbox-checked[_ngcontent-%COMP%]{opacity:1;top:1em}[_nghost-%COMP%]   .album-card-content.drag-area[_ngcontent-%COMP%]{min-height:32em;transition:box-shadow .28s cubic-bezier(.4,0,.2,1);transition:background-image .6s ease-in-out}[_nghost-%COMP%]   .album-card-content.drag-area.drag-over[_ngcontent-%COMP%]{box-shadow:0 2px 4px -1px #0003,0 4px 5px #00000024,0 1px 10px #0000001f;background-color:#fff6;background-image:url(/figures/drop-photos.svg);background-position:center center;background-repeat:no-repeat}"],changeDetection:0})}return t})();var as=[{path:"",data:{breadcrumb:"Administra\xE7\xE3o"},providers:Ln,component:In,children:[{path:"meus-albuns/:id",data:{breadcrumb:t=>t.album.title},title:"Meu album",resolve:{album:Rn},component:Yn},{path:"meus-albuns",data:{breadcrumb:"Meus albuns"},title:"Meus albuns",component:Zn},{path:"gerenciar-albuns",data:{breadcrumb:"Gerenciar albuns"},title:"Gerenciar albuns",canActivate:[un("director","manager","staff")],component:Vn},{path:"",pathMatch:"prefix",redirectTo:"meus-albuns"}]}];export{In as AlbumFeatureAdminComponent,as as albumFeatureAdminRoutes};
