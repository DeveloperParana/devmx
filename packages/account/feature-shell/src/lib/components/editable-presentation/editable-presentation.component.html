<form [formGroup]="form" (submit)="onSubmit()">
  <mat-form-field>
    <mat-label>Título da apresentação</mat-label>
    <input type="text" matInput formControlName="title" />
    <mat-error>Obrigatório</mat-error>
  </mat-form-field>

  <mat-form-field>
    <mat-label>Resenha</mat-label>
    <textarea
      matInput
      formControlName="description"
      cdkAutosizeMinRows="1"
      cdkAutosizeMaxRows="10"
      cdkTextareaAutosize
      rows="3"
    ></textarea>
    <mat-hint>Introdução com no máximo 512 caracteres</mat-hint>
    <mat-error>
      @if (form.controls.description.value.length > 512) { Você usou
      {{ form.controls.description.value.length - 512 }} caracteres acima do
      máximo aceito } @else { Obrigatório }
    </mat-error>
  </mat-form-field>

  <mat-form-field>
    <mat-label>Formato da apresentação</mat-label>
    <mat-select formControlName="format">
      @for (format of form.formats; track format) {
      <mat-option [value]="format.value">{{ format.viewValue }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <mat-list class="sortable-list" cdkDropList (cdkDropListDropped)="dropResources($event)">
    <h3 mat-subheader>Links úteis</h3>

    @for (resource of form.resources.controls; track resource; let index =
    $index) {
    <mat-list-item class="sortable-list-item" cdkDrag>
      <mat-icon matListItemIcon>link</mat-icon>
      <div matListItemTitle>{{ resource.value }}</div>
      <button
        type="button"
        matListItemMeta
        mat-icon-button
        (click)="form.removeResource(index)"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-list-item>
    }
  </mat-list>
  <mat-form-field>
    <mat-label>Link</mat-label>
    <input
      type="text"
      matInput
      [formControl]="form.currentResource"
      (keydown.enter)="form.addResource($event)"
    />
    <mat-hint>Use a tecla <kbd>enter</kbd> para adicionar</mat-hint>
    <mat-error>URL inválida</mat-error>
  </mat-form-field>

  <mat-list class="sortable-list" cdkDropList (cdkDropListDropped)="dropTags($event)">
    <h3 mat-subheader>Tags</h3>

    @for (tag of form.tags.controls; track tag; let index = $index) {
    <mat-list-item class="sortable-list-item" cdkDrag>
      <mat-icon matListItemIcon>tag</mat-icon>
      <div matListItemTitle>{{ tag.value }}</div>
      <button
        type="button"
        matListItemMeta
        mat-icon-button
        (click)="form.removeTag(index)"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-list-item>
    }
  </mat-list>
  <mat-form-field>
    <mat-label>Tag</mat-label>
    <input
      type="text"
      matInput
      [formControl]="form.currentTag"
      (keydown.enter)="form.addTag($event)"
    />
    <mat-hint>Use a tecla <kbd>enter</kbd> para adicionar</mat-hint>
    <mat-error>Apenas letras e números</mat-error>
  </mat-form-field>

  <mat-checkbox formControlName="visible"> Visível publicamente </mat-checkbox>
  <footer>
    <button mat-flat-button>Salvar</button>
  </footer>
</form>
